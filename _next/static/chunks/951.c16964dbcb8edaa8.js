(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[951,566],{9744:function(e,t,i){"use strict";i.d(t,{LoadScene:function(){return h},MainScene:function(){return b},MenuScene:function(){return y}});var s=i(4110);class h extends s.Scene{preload(){let e=this.add.graphics(),t=this.add.graphics();t.fillStyle(0,.2),t.fillRect(240,270,320,50);let i=this.cameras.main.width,s=this.cameras.main.height,h=this.make.text({x:i/2,y:s/2-50,text:"Loading...",style:{font:"20px monospace",color:"#000000"}});h.setOrigin(.5,.5);let r=this.make.text({x:i/2,y:s/2-5,text:"0%",style:{font:"18px monospace",color:"#000000"}});r.setOrigin(.5,.5);let n=this.make.text({x:i/2,y:s/2+50,text:"",style:{font:"18px monospace",color:"#000000"}});n.setOrigin(.5,.5),this.load.on("progress",function(t){r.setText(Math.ceil(100*t)+"%"),e.clear(),e.fillStyle(16777215,1),e.fillRect(250,280,300*t,30)}),this.load.on("fileprogress",function(e){n.setText("Loading asset: "+e.key)}),this.load.on("complete",function(){e.destroy(),t.destroy(),h.destroy(),r.destroy(),n.destroy()}),this.load.image("white","/img/white.png"),this.load.image("edge-e","/img/edge-e.png"),this.load.image("edge-ne","/img/edge-ne.png"),this.load.image("edge-nw","/img/edge-nw.png"),this.load.image("edge-w","/img/edge-w.png"),this.load.image("edge-sw","/img/edge-sw.png"),this.load.image("edge-se","/img/edge-se.png"),this.load.image("empty","/img/empty.png"),this.load.image("empty-hill","/img/empty-hill.png"),this.load.image("mine","/img/mine/mine.png"),this.load.image("mine-bw","/img/mine/mine-bw.png"),this.load.image("mine-red","/img/mine/mine-red.png"),this.load.image("grass","/img/grass.png"),this.load.image("grass-bw","/img/grass-bw.png"),this.load.image("grass-red","/img/grass-red.png"),this.load.image("tree","/img/tree.png"),this.load.image("tree-bw","/img/tree-bw.png"),this.load.image("street","/img/street.png"),this.load.image("street-red","/img/street-red.png"),this.load.image("street-bw","/img/street-bw.png"),this.load.image("house","/img/house.png"),this.load.image("house-bw","/img/house-bw.png"),this.load.image("center","/img/center.png"),this.load.image("center-bw","/img/center-bw.png"),this.load.image("windmill","/img/windmill.png"),this.load.image("propeller","/img/propeller.png"),this.load.image("windmill-red","/img/windmill-red.png"),this.load.image("windmill-hill","/img/windmill-hill.png"),this.load.image("windmill-bw","/img/windmill-bw.png"),this.load.image("windmill-hill-bw","/img/windmill-hill-bw.png"),this.load.image("port-bw","/img/port.png"),this.load.image("rock","/img/rock/rock.png"),this.load.image("rock-bw","/img/rock/rock-bw.png"),this.load.image("rock-red","/img/rock/rock-red.png"),this.load.spritesheet("port","/img/port-color.png",{frameWidth:140,frameHeight:140}),this.load.image("blue","/img/blue.png"),this.load.image("rotate","/img/rotate.png"),this.load.image("question","/img/question.png"),this.load.image("x","/img/x.png"),this.load.image("help-page","/img/help-page.png"),this.load.image("page","/img/page.png"),this.load.image("waves","/img/waves.png"),this.load.image("waves2","/img/waves2.png"),this.load.image("particle","/img/particle.png"),this.load.image("next_arrow","/img/next_arrow.png"),this.load.image("a-shape","/img/a-shape.png"),this.load.image("c-shape","/img/c-shape.png"),this.load.image("slash-shape","/img/slash-shape.png"),this.load.spritesheet("tutorial-button","/img/tutorial-button.png",{frameWidth:811,frameHeight:91}),this.load.image("play-button","/img/playBtn.png"),this.load.image("play-again-button","/img/play-again-button.png"),this.load.image("how-to-play-button","/img/howtoplay.png"),this.load.image("play-free-demo-button","/img/playFreeDemo.png"),this.load.image("share-score-button","/img/shareScoreBtn.png"),this.load.bitmapFont("font","/font/font.png","/font/font.fnt"),this.load.audio("pop","/sfx/pop.wav"),this.load.audio("place","/sfx/place.wav"),this.load.audio("tree","/sfx/tree.wav"),this.load.audio("windmill","/sfx/windmill.wav"),this.load.audio("windmill-hill","/sfx/windmill-hill.wav"),this.load.audio("port","/sfx/port.wav"),this.load.audio("splash","/sfx/splash.wav"),this.load.audio("click","/sfx/click.wav"),this.load.audio("digging","/sfx/digging.mp3"),this.load.text("levels","/data/levels.json")}create(){this.scene.start("menu")}constructor(){super("load")}}let r={a:[{ro:0,co:0},{ro:1,co:-1},{ro:1,co:0}],v:[{ro:0,co:0},{ro:0,co:1},{ro:1,co:0}],"\\":[{ro:-1,co:0},{ro:0,co:0},{ro:1,co:0}],"-":[{ro:0,co:-1},{ro:0,co:0},{ro:0,co:1}],"/":[{ro:-1,co:1},{ro:0,co:0},{ro:1,co:-1}],c:[{ro:-1,co:1},{ro:0,co:0},{ro:1,co:0}],r:[{ro:0,co:1},{ro:0,co:0},{ro:1,co:-1}],n:[{ro:0,co:-1},{ro:0,co:0},{ro:1,co:0}],d:[{ro:-1,co:0},{ro:0,co:0},{ro:1,co:-1}],j:[{ro:-1,co:1},{ro:0,co:0},{ro:0,co:-1}],l:[{ro:-1,co:0},{ro:0,co:0},{ro:0,co:1}]},n={a:["a","v"],v:["a","v"],"\\":["\\","-","/"],"-":["\\","-","/"],"/":["\\","-","/"],c:["c","r","n","d","j","l"],r:["c","r","n","d","j","l"],n:["c","r","n","d","j","l"],d:["c","r","n","d","j","l"],j:["c","r","n","d","j","l"],l:["c","r","n","d","j","l"]};class o extends s.GameObjects.Image{puff(){this.puffer.emitParticleAt(this.x,this.y,10)}setX(e){return super.setX(e),this.eEdge.setX(e),this.neEdge.setX(e),this.nwEdge.setX(e),this.wEdge.setX(e),this.swEdge.setX(e),this.seEdge.setX(e),this.propeller.setX(e),this}setY(e){return super.setY(e),this.eEdge.setY(e),this.neEdge.setY(e),this.nwEdge.setY(e),this.wEdge.setY(e),this.swEdge.setY(e),this.seEdge.setY(e),this.propeller.setY(e),this}embiggen(){this.eEdge.setScale(.75),this.neEdge.setScale(.75),this.nwEdge.setScale(.75),this.wEdge.setScale(.75),this.swEdge.setScale(.75),this.seEdge.setScale(.75),this.edges.setAlpha(1),this.edges.setDepth(5),this.propeller.setDepth(6),this.propeller.setScale(.75),this.setScale(.75)}setType(e){this.setTexture(["empty","windmill","grass","street","center","port-bw","mine","rock"][e]),this.hexType=e,1===e?(this.propeller.setVisible(!0),this.hasHill?(this.propeller.setY(this.y-70*this.scale),this.setTexture("windmill-hill")):this.propeller.setY(this.y-30*this.scale)):this.propeller.setVisible(!1),1===e?this.puffer.setParticleTint(16777215):2===e?this.puffer.setParticleTint(4229647):3===e?this.puffer.setParticleTint(11421740):5===e?this.puffer.setParticleTint(3899558):7===e&&this.puffer.setParticleTint(8421504),5===e&&(this.eEdge.setVisible(!1),this.neEdge.setVisible(!1),this.seEdge.setVisible(!1),this.wEdge.setVisible(!1),this.nwEdge.setVisible(!1),this.swEdge.setVisible(!1))}setHill(e){this.hasHill=e,e&&this.setTexture("empty-hill")}upgrade(){this.upgraded=!0,2===this.hexType?this.setTexture("tree"):3===this.hexType?this.setTexture("house"):5===this.hexType&&this.setTexture("port")}setSketchy(e){e?0===this.hexType?this.setTexture("empty"):1===this.hexType?(this.hasHill?this.setTexture("windmill-hill-bw"):this.setTexture("windmill-bw"),this.propeller.setVisible(!1)):2===this.hexType?this.upgraded?this.setTexture("tree-bw"):this.setTexture("grass-bw"):3===this.hexType?this.upgraded?this.setTexture("house-bw"):this.setTexture("street-bw"):4===this.hexType?this.setTexture("center-bw"):5===this.hexType?this.setTexture("port-bw"):6===this.hexType&&this.setTexture("mine-bw"):(this.setAlpha(1),0===this.hexType?this.setTexture("empty"):1===this.hexType?(this.hasHill?this.setTexture("windmill-hill"):this.setTexture("windmill"),this.propeller.setVisible(!0)):2===this.hexType?this.upgraded?this.setTexture("tree"):this.setTexture("grass"):3===this.hexType?this.upgraded?this.setTexture("house"):this.setTexture("street"):4===this.hexType?this.setTexture("center"):5===this.hexType?this.upgraded?this.setTexture("port"):this.setTexture("port-bw"):6===this.hexType&&this.setTexture("mine-bw"))}update(e,t){if(this.propeller.visible){let e=this.hasHill&&this.counted?2.2:this.counted?1:.1;this.propeller.setAngle(this.propeller.angle+.1*e*t)}}constructor(e,t,i,s,h){super(e,t,i,"empty"),this.setScale(.5),e.add.existing(this),this.row=s,this.col=h,this.hexType=0,this.hasHill=!1,this.counted=!1,this.upgraded=!1,this.eEdge=e.add.image(t,i,"edge-e"),this.neEdge=e.add.image(t,i,"edge-ne"),this.nwEdge=e.add.image(t,i,"edge-nw"),this.wEdge=e.add.image(t,i,"edge-w"),this.swEdge=e.add.image(t,i,"edge-sw"),this.seEdge=e.add.image(t,i,"edge-se"),this.edges=e.add.group([this.eEdge,this.neEdge,this.nwEdge,this.wEdge,this.swEdge,this.seEdge]),this.edges.setDepth(1),this.edges.setAlpha(1),this.eEdge.setScale(.5),this.neEdge.setScale(.5),this.nwEdge.setScale(.5),this.wEdge.setScale(.5),this.swEdge.setScale(.5),this.seEdge.setScale(.5),this.propeller=e.add.image(t,i,"propeller"),this.propeller.setScale(.5),this.propeller.setVisible(!1),this.propeller.setDepth(2),this.puffer=e.add.particles(0,0,"particle",{lifespan:1e3,speed:{min:3,max:20},angle:{min:0,max:360},scale:2,quantity:20,emitting:!1,alpha:{start:1,end:0},emitZone:{type:"random",source:new Phaser.Geom.Rectangle(-25,-25,50,50),quantity:20}}),this.puffer.setDepth(1)}}function a(e){let t=null==e?0:e.length;if(!t)return[];let i=-1,s=t-1,h=function(e,t){let i=-1,s=e.length;for(t||(t=Array(s));++i<s;)t[i]=e[i];return t}(e);for(;++i<t;){let e=i+Math.floor(Math.random()*(s-i+1)),t=h[e];h[e]=h[i],h[i]=t}return h}class l extends Phaser.GameObjects.Sprite{onOver(){this.setScale(1.075)}onOut(){this.down=!1,this.setScale(1)}onUp(){this.scene.sound.play("click",{volume:.9}),this.setScale(1),this.down&&this.onDownCallback()}onDown(){this.scene.sound.play("click",{volume:.4}),this.setScale(.9),this.down=!0}constructor(e,t,i,s,h){super(e,t,i,s),e.add.existing(this),this.onDownCallback=h,this.down=!1,this.setInteractive(),this.on(Phaser.Input.Events.POINTER_DOWN,this.onDown,this),this.on(Phaser.Input.Events.POINTER_OUT,this.onOut,this),this.on(Phaser.Input.Events.POINTER_OVER,this.onOver,this),this.on(Phaser.Input.Events.POINTER_UP,this.onUp,this)}}class d{enq(e){this.data.set(this.tail,e),this.tail++}deq(){if(this.data.has(this.head)){let e=this.data.get(this.head);return this.data.delete(this.head),this.head++,e}}size(){return this.tail-this.head}constructor(){this.data=new Map,this.head=0,this.tail=0}}class g{set(e,t,i){let s=this.rows.get(e);s||(s=new Map,this.rows.set(e,s)),s.set(t,i)}get(e,t){let i=this.rows.get(e);return i&&i.get(t)||null}delete(e,t){let i=this.rows.get(e);i&&i.delete(t)}has(e,t){let i=this.rows.get(e);return!!i&&i.has(t)}constructor(){this.rows=new Map}}function u(e){return e[Math.floor(Math.random()*e.length)]}class p extends s.GameObjects.BitmapText{pop(){this.setAlpha(1),this.scene.tweens.add({targets:this,props:{alpha:0,y:this.y-140},duration:2e3})}constructor(e,t,i){let s=0,h=0;for(let e of t)s+=e.x,h+=e.y;super(e,s/t.length,h/t.length,"font",i>0?"+"+String(i):String(i),40),e.add.existing(this),this.points=i,this.setScale(Math.max(1,.9+.1*i)),this.setAlpha(0),this.setOrigin(.5),this.setDepth(5),this.hexes=t}}class c extends s.GameObjects.Group{placeRocks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=0;for(this.grid.get(this.size,this.size);t<e;){let e=Math.floor(Math.random()*(this.size+this.size+1)),i=Math.floor(Math.random()*(this.size+this.size+1)),s=this.grid.get(e,i);s&&this.canPlaceRock(e,i)&&(s.setType(7),t++)}this.updateEdges()}canPlaceRock(e,t){let i=this.grid.get(e,t);if(!i||0!==i.hexType||i.hasHill||0===e||e===2*this.size||0===t||t===2*this.size)return!1;for(let i of this.neighbors(e,t))if((null==i?void 0:i.hexType)===7)return!1;return!0}isBuildable(e,t){if(!this.grid.get(e,t))return!1;for(let i of this.neighbors(e,t))if((null==i?void 0:i.hexType)===7)return!1;return!0}updateEdges(){for(let u=0;u<this.size+this.size+1;u++)for(let p=0;p<this.size+this.size+1;p++)if(this.grid.has(u,p)){var e,t,i,s,h,r,n,o,a,l,d,g;let c=this.grid.get(u,p);this.grid.has(u,p+1)&&(null===(e=this.grid.get(u,p+1))||void 0===e?void 0:e.hexType)!==5?c.eEdge.setAlpha(0):c.eEdge.setAlpha(1),this.grid.has(u-1,p+1)&&(null===(t=this.grid.get(u-1,p+1))||void 0===t?void 0:t.hexType)!==5?c.neEdge.setAlpha(0):c.neEdge.setAlpha(1),this.grid.has(u-1,p)&&(null===(i=this.grid.get(u-1,p))||void 0===i?void 0:i.hexType)!==5?c.nwEdge.setAlpha(0):c.nwEdge.setAlpha(1),this.grid.has(u,p-1)&&((null===(s=this.grid.get(u,p-1))||void 0===s?void 0:s.hexType)===c.hexType||4===c.hexType&&(null===(h=this.grid.get(u,p-1))||void 0===h?void 0:h.hexType)===3||3===c.hexType&&(null===(r=this.grid.get(u,p-1))||void 0===r?void 0:r.hexType)===4)?c.wEdge.setAlpha(.4):c.wEdge.setAlpha(1),this.grid.has(u+1,p-1)&&((null===(n=this.grid.get(u+1,p-1))||void 0===n?void 0:n.hexType)===c.hexType||4===c.hexType&&(null===(o=this.grid.get(u+1,p-1))||void 0===o?void 0:o.hexType)===3||3===c.hexType&&(null===(a=this.grid.get(u+1,p-1))||void 0===a?void 0:a.hexType)===4)?c.swEdge.setAlpha(.4):c.swEdge.setAlpha(1),this.grid.has(u+1,p)&&((null===(l=this.grid.get(u+1,p))||void 0===l?void 0:l.hexType)===c.hexType||4===c.hexType&&(null===(d=this.grid.get(u+1,p))||void 0===d?void 0:d.hexType)===3||3===c.hexType&&(null===(g=this.grid.get(u+1,p))||void 0===g?void 0:g.hexType)===4)?c.seEdge.setAlpha(.4):c.seEdge.setAlpha(1)}}sinkBlanks(){var e,t,i,s,h,r;for(let e of(this.scene.sound.play("splash",{volume:.75}),this.hexes))0!==e.hexType&&(5!==e.hexType||e.counted)||(e.puffer.setParticleTint(3899558),e.puff(),e.setVisible(!1),e.edges.setVisible(!1),this.grid.delete(e.row,e.col));null===(e=this.grid.get(0,this.size))||void 0===e||e.setFrame((this.grid.has(1,this.size-1)?4:0)+(this.grid.has(1,this.size)?2:0)+(this.grid.has(0,this.size+1)?1:0)),null===(t=this.grid.get(this.size,0))||void 0===t||t.setFrame((this.grid.has(this.size+1,0)?4:0)+(this.grid.has(this.size,1)?2:0)+(this.grid.has(this.size-1,1)?1:0)),null===(i=this.grid.get(0,2*this.size))||void 0===i||i.setFrame((this.grid.has(0,2*this.size-1)?4:0)+(this.grid.has(1,2*this.size-1)?2:0)+(this.grid.has(1,2*this.size)?1:0)),null===(s=this.grid.get(this.size,2*this.size))||void 0===s||s.setFrame((this.grid.has(this.size-1,2*this.size)?4:0)+(this.grid.has(this.size,2*this.size-1)?2:0)+(this.grid.has(this.size+1,2*this.size-1)?1:0)),null===(h=this.grid.get(2*this.size,0))||void 0===h||h.setFrame((this.grid.has(2*this.size,1)?4:0)+(this.grid.has(2*this.size-1,1)?2:0)+(this.grid.has(2*this.size-1,0)?1:0)),null===(r=this.grid.get(2*this.size,this.size))||void 0===r||r.setFrame((this.grid.has(2*this.size-1,this.size+1)?4:0)+(this.grid.has(2*this.size-1,this.size)?2:0)+(this.grid.has(2*this.size,this.size-1)?1:0)),this.updateEdges()}canPlaceShape(e){for(let i of this.hexes)if(0===i.hexType)for(let s of n[e]){let e=!0;for(let h of r[s]){var t;let s=i.row+h.ro,r=i.col+h.co;if(!(this.grid.has(s,r)&&(null===(t=this.grid.get(s,r))||void 0===t?void 0:t.hexType)===0)){e=!1;break}if(this.grid.get(s,r)){for(let t of this.neighbors(s,r))if((null==t?void 0:t.hexType)===7){e=!1;break}}}if(e){let e=!1;for(let t of r[s]){let s=i.row+t.ro,h=i.col+t.co;for(let t of this.neighbors(s,h))if(t&&(1===t.hexType||2===t.hexType||3===t.hexType||4===t.hexType)){e=!0;break}}if(e)return!0}}return!1}neighbors(e,t){return[this.grid.get(e,t+1),this.grid.get(e-1,t+1),this.grid.get(e-1,t),this.grid.get(e,t-1),this.grid.get(e+1,t-1),this.grid.get(e+1,t)]}deactivate(){this.enabled=!1,this.triPreviews[0].setVisible(!1),this.triPreviews[1].setVisible(!1),this.triPreviews[2].setVisible(!1)}activate(){this.enabled=!0,this.triPreviews[0].setVisible(!0),this.triPreviews[1].setVisible(!0),this.triPreviews[2].setVisible(!0)}updateTriPreview(e,t,i){if(!this.enabled)return;"a"===i.shape&&(t-=35),"v"===i.shape&&(t-=35,e-=30.310889);let s=x(e,t),h=m(e,t),n=[],o=!1;for(let e=0;e<3;e++){var a;let t=r[i.shape][e];if(n.push(this.grid.get(s+t.ro,h+t.co)),this.triPreviews[e].setX((a=s+t.ro,(h+t.co+.5*a)*60.621778-50)),this.triPreviews[e].setY(100+52.5*(s+t.ro)),!o){for(let e of this.neighbors(s+t.ro,h+t.co))if(e&&(1===e.hexType||2===e.hexType||3===e.hexType||4===e.hexType)){o=!0;break}}}if(o&&n[0]&&0===n[0].hexType&&n[1]&&0===n[1].hexType&&n[2]&&0===n[2].hexType)for(let e=0;e<3;e++)this.triPreviews[e].setTexture(["white","windmill-bw","grass-bw","street-bw","","","mine-bw","rock-bw"][i.hexes[e]]);else for(let e=0;e<3;e++)this.triPreviews[e].setTexture(["white","windmill-red","grass-red","street-red","","","mine-red","rock-red"][i.hexes[e]])}placeTrihex(e,t,i,s){"a"===i.shape&&(t-=35),"v"===i.shape&&(t-=35,e-=30.310889);let h=x(e,t),n=m(e,t),o=[],a=!1;for(let e=0;e<3;e++){let t=r[i.shape][e],s=h+t.ro,l=n+t.co;if(this.grid.get(s,l)){for(let e of this.neighbors(s,l))if((null==e?void 0:e.hexType)===7)return!1}if(o.push(this.grid.get(s,l)),!a){for(let e of this.neighbors(s,l))if(e&&(1===e.hexType||2===e.hexType||3===e.hexType||4===e.hexType)){a=!0;break}}}if(!a||!o[0]||0!==o[0].hexType||!o[1]||0!==o[1].hexType||!o[2]||0!==o[2].hexType)return!1;{this.scene.sound.play("place");let e=[];for(let t=0;t<3;t++)o[t].setType(i.hexes[t]),e.push({row:o[t].row,col:o[t].col,tile_type:i.hexes[t]});for(let e=0;e<3;e++)for(let t of(this.getPointsFor(o[e]),this.neighbors(o[e].row,o[e].col)))t&&6===t.hexType&&this.getPointsFor(t);for(let e=0;e<3;e++)this.getPointsFor(o[e]);return s&&s(e),this.updateEdges(),!0}}getConnected(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[],s=new Set,h=new d;for(h.enq(e);h.size()>0;){let e=h.deq();for(let r of(s.has(e)||i.push(e),s.add(e),this.neighbors(e.row,e.col)))r&&!s.has(r)&&(r.hexType===e.hexType||3===e.hexType&&5===r.hexType||t&&(6===e.hexType||6===r.hexType))&&h.enq(r)}return i}getPointsFor(e){if(!e.counted){if(1===e.hexType){let t=!0,i=0;for(let t=e.row-2;t<=e.row+2;t++)for(let s=e.col-2;s<=e.col+2;s++){let e=this.grid.get(t,s);if((null==e?void 0:e.hexType)===7){i=-1;break}}for(let i of this.neighbors(e.row,e.col))(null==i?void 0:i.hexType)===1&&(t=!1,i.counted&&(i.counted=!1,this.scoreQueue.enq(new p(this.scene,[i],i.hasHill?-3:-1))));if(t){let t=e.hasHill?3:1;this.scoreQueue.enq(new p(this.scene,[e],t+i)),e.counted=!0}}else if(2===e.hexType){let t=this.getConnected(e).filter(e=>!e.counted);for(;t.length>=3;){let e=t.splice(0,3);e.forEach(e=>e.counted=!0),this.scoreQueue.enq(new p(this.scene,e,5))}}else if(3===e.hexType){for(let t of this.neighbors(e.row,e.col))(null==t?void 0:t.hexType)!==4||e.counted||(this.scoreQueue.enq(new p(this.scene,[e],1)),e.counted=!0);let t=this.getConnected(e);if(t.some(e=>3===e.hexType&&e.counted))for(let e of t)e.counted||(this.scoreQueue.enq(new p(this.scene,[e],5===e.hexType?3:1)),e.counted=!0)}else if(6===e.hexType){let t=!1;for(let i of this.neighbors(e.row,e.col))if((null==i?void 0:i.hexType)===3&&i.counted){t=!0;break}if(t&&!e.counted){let t=this.getConnected(e,!0).filter(e=>6===e.hexType),i=(t.filter(e=>e.counted).length+1)%3==0;for(let s of(this.scoreQueue.enq(new p(this.scene,[e],2+(i?5:0))),e.counted=!0,i&&(e.upgraded=!0),t))s.counted||this.getPointsFor(s)}}}}nextPopper(){if(this.scoreQueue.size()>0){let e=this.scoreQueue.deq();for(let t of(e.pop(),this.onNewPoints&&this.onNewPoints(e.points,e.hexes[0].hexType),e.hexes))t.upgrade(),e.points>0&&t.puff();e.points>0&&(3===e.hexes[0].hexType&&this.scene.sound.play("pop",{volume:.5}),2===e.hexes[0].hexType&&this.scene.sound.play("tree",{volume:.5}),1===e.hexes[0].hexType&&(e.hexes[0].hasHill?this.scene.sound.play("windmill-hill",{volume:.6}):this.scene.sound.play("windmill",{volume:.6})),5===e.hexes[0].hexType&&this.scene.sound.play("port",{volume:.9}),6===e.hexes[0].hexType&&this.scene.sound.play("digging",{volume:1}))}else this.onQueueEmpty&&(this.onQueueEmpty(),this.onQueueEmpty=null)}constructor(e,t,i,s,h,r){var n,a,l,u,p,c,x,m,v,w,T,f,y,b,k,P,E,B;super(e),this.scoreText=null,this.onQueueEmpty=null,this.enabled=!0,this.grid=new g,this.hexes=[],this.size=t,this.onNewPoints=r,this.x=s||0,this.y=h||0,this.scoreQueue=new d;for(let i=0;i<t+t+1;i++)for(let s=0;s<t+t+1;s++)if(!(s+i<t)&&!(s+i>3*t)){let t=new o(e,(s+.5*i)*60.621778-50+this.x,100+52.5*i+this.y,i,s);this.add(t),this.grid.set(i,s,t),this.hexes.push(t)}null===(n=this.grid.get(0,t))||void 0===n||n.setType(5),null===(a=this.grid.get(0,t))||void 0===a||a.setAngle(-60),null===(l=this.grid.get(0,2*t))||void 0===l||l.setType(5),null===(u=this.grid.get(t,0))||void 0===u||u.setType(5),null===(p=this.grid.get(t,0))||void 0===p||p.setAngle(-120),null===(c=this.grid.get(t,2*t))||void 0===c||c.setType(5),null===(x=this.grid.get(t,2*t))||void 0===x||x.setAngle(60),null===(m=this.grid.get(t,t))||void 0===m||m.setType(4),null===(v=this.grid.get(2*t,0))||void 0===v||v.setType(5),null===(w=this.grid.get(2*t,0))||void 0===w||w.setAngle(-180),null===(T=this.grid.get(2*t,t))||void 0===T||T.setType(5),null===(f=this.grid.get(2*t,t))||void 0===f||f.setAngle(120);let S=0;for(;S<i;){let e=Math.floor(Math.random()*(t+t+1)),i=Math.floor(Math.random()*(t+t+1)),s=this.grid.get(e,i);!s||s.hasHill||0!==s.hexType||this.grid.has(e,i+1)&&(null===(y=this.grid.get(e,i+1))||void 0===y?void 0:y.hasHill)||this.grid.has(e-1,i+1)&&(null===(b=this.grid.get(e-1,i+1))||void 0===b?void 0:b.hasHill)||this.grid.has(e-1,i)&&(null===(k=this.grid.get(e-1,i))||void 0===k?void 0:k.hasHill)||this.grid.has(e,i-1)&&(null===(P=this.grid.get(e,i-1))||void 0===P?void 0:P.hasHill)||this.grid.has(e+1,i-1)&&(null===(E=this.grid.get(e+1,i-1))||void 0===E?void 0:E.hasHill)||this.grid.has(e+1,i)&&(null===(B=this.grid.get(e+1,i))||void 0===B?void 0:B.hasHill)||(s.setHill(!0),S+=1)}this.updateEdges(),this.triPreviews=[];for(let t=0;t<3;t++){let t=e.add.image(-200,-200,"white");t.setScale(.5),t.setAlpha(.5),this.triPreviews.push(t)}e.time.addEvent({repeat:-1,callback:this.nextPopper,callbackScope:this,delay:100})}}function x(e,t){return Math.floor((t-100+28)/52.5)}function m(e,t){return Math.floor((e+50+30.310889)/60.621778-.5*x(e,t))}class v{rotateRight(){if("a"===this.shape){this.shape="v";let e=this.hexes[0];this.hexes[0]=this.hexes[1],this.hexes[1]=e}else if("v"===this.shape){this.shape="a";let e=this.hexes[1];this.hexes[1]=this.hexes[2],this.hexes[2]=e}else if("\\"===this.shape)this.shape="/";else if("/"===this.shape){this.shape="-";let e=this.hexes[0];this.hexes[0]=this.hexes[2],this.hexes[2]=e}else if("-"===this.shape)this.shape="\\";else if("c"===this.shape)this.shape="r";else if("r"===this.shape){this.shape="n";let e=this.hexes[0];this.hexes[0]=this.hexes[2],this.hexes[2]=e}else if("n"===this.shape)this.shape="d";else if("d"===this.shape)this.shape="j";else if("j"===this.shape){this.shape="l";let e=this.hexes[0];this.hexes[0]=this.hexes[2],this.hexes[2]=e}else"l"===this.shape&&(this.shape="c")}rotateLeft(){if("a"===this.shape){this.shape="v";let e=this.hexes[1];this.hexes[1]=this.hexes[2],this.hexes[2]=e}else if("v"===this.shape){this.shape="a";let e=this.hexes[0];this.hexes[0]=this.hexes[1],this.hexes[1]=e}else if("\\"===this.shape)this.shape="-";else if("/"===this.shape)this.shape="\\";else if("-"===this.shape){this.shape="/";let e=this.hexes[0];this.hexes[0]=this.hexes[2],this.hexes[2]=e}else if("c"===this.shape)this.shape="l";else if("r"===this.shape)this.shape="c";else if("n"===this.shape){this.shape="r";let e=this.hexes[0];this.hexes[0]=this.hexes[2],this.hexes[2]=e}else if("d"===this.shape)this.shape="n";else if("j"===this.shape)this.shape="d";else if("l"===this.shape){this.shape="j";let e=this.hexes[0];this.hexes[0]=this.hexes[2],this.hexes[2]=e}}constructor(e,t,i,s){this.hexes=[e,t,i],this.shape=s}}let w=["TileVille is city development Arcade game \nwhere you join a competition to play\nthe game and build your city.\n\nEvery competition have a associated\nparticipation fees and rewards.","Place trios of hexes to grow your city\noutward from the Center\n\n\nTry to get the highest score you can!","ROAD hexes are worth 1 point each\nif they're connected to the Center\n\nAdditionally, every Port that you\nconnect to the Center with\nRoads is worth 3 points!","Wind Mills are worth 1 point if\nthey're not adjacent to any other\nWind Mills\n\nIf they're also placed on a HILL,\nthey're worth 3 points!","Those are PARKS!\n\nEach group of connected Park hexes is\nworth 5 points for every 3 hexes in it","Yep! To recap:\n- Roads want to connect Ports to\nthe Center\n- Wind Mills want to be alone and\non Hills\n- Parks want to be grouped together\nin multiples of 3"],T=[[1,2,3,4,5],[1,2,3,4,5],[1,2,3,4,5],[3,4,5],[1],[2],[1,2,3,4,5]],f={level:1};class y extends s.Scene{create(){var e,t,i,s,h,r,n,o,a,d,g,u,p,x,m,v,T,f,y,b,k,P,E;this.cameras.main.setBounds(-1280,0,3840,720),this.cameras.main.setBackgroundColor("rgba(0 , 0 , 0 , 0)"),this.menu=this.add.group();let B=this.add.image(920,360,"map_pattern");B.setScale(.05),B.setAlpha(.3);let S=this.add.text(140,150,"TileVille",{fontFamily:"monospace",fontSize:"70px",color:"#000"}),C=this.add.text(150,240,"On-chain City-Development \nGame on MINA blockchain",{fontFamily:"monospace",fontSize:"70px",color:"#000"});if(S.setTint(16777215),C.setTint(16777215),C.setScale(.3),this.menu.add(S),this.game.registry.get("isDemoGame")){let e=this.add.image(310,480,"play-free-demo-button");e.setOrigin(.5),e.setInteractive({cursor:"pointer",textDecoration:"underline"}),e.on("pointerdown",()=>{console.log("clicked"),this.cameras.main.pan(-1405,0,500,"Linear",!0),this.time.addEvent({delay:500,callback:this.transition,callbackScope:this})}),e.on("pointerover",()=>{e.setScale(1.03)}),e.on("pointerout",()=>{e.setScale(1)}),e.on("pointerover",()=>{this.tweens.add({targets:e,scaleX:1.1,scaleY:1.1,duration:60,ease:"Linear"})}),e.on("pointerout",()=>this.tweens.add({targets:e,scaleX:1,scaleY:1,duration:60,ease:"Linear"}))}else{let e=this.add.image(300,400,"play-button");e.setOrigin(.5),e.setInteractive({useHandCursor:!0}),e.on("pointerover",()=>{this.tweens.add({targets:e,scaleX:1.1,scaleY:1.1,duration:60,ease:"Linear"})}),e.on("pointerout",()=>this.tweens.add({targets:e,scaleX:1,scaleY:1,duration:60,ease:"Linear"})),e.on("pointerdown",()=>{this.tweens.add({targets:e,scaleX:1.1,scaleY:1.1,duration:60,ease:"Linear"}),this.play()}),e.on("pointerup",()=>{this.play()}),this.menu.add(e)}let V=this.add.image(100,700,"how-to-play-button");V.setOrigin(.5),V.setInteractive({useHandCursor:!0}),V.on("pointerdown",()=>this.howToPlay()),V.on("pointerover",()=>{this.tweens.add({targets:V,scaleX:1.1,scaleY:1.1,duration:60,ease:"Linear"})}),V.on("pointerout",()=>this.tweens.add({targets:V,scaleX:1,scaleY:1,duration:60,ease:"Linear"})),this.menu.add(V);let A=new c(this,3,0,700,100);A.grid.get(2,2).setHill(!0),A.grid.get(4,5).setHill(!0);let X=[[null,null,null,5,3,2,5],[null,null,2,3,2,1,3],[null,2,1,3,2,3,3],[5,3,2,4,2,1,5],[2,2,2,3,3,1,null],[2,2,3,1,2,null,null],[5,3,3,5,null,null,null]];this.tutorialPage=0,this.tutorialText=this.add.bitmapText(1405,200,"font",w[0],40),this.previousArrowBtn=new l(this,1490,550,"next_arrow",this.backTutorialPage.bind(this)),this.previousArrowBtn.angle=180,this.previousArrowBtn.setOrigin(0,.5),this.nextArrowBtn=new l(this,1890,550,"next_arrow",this.nextTutorialPage.bind(this)),this.nextArrowBtn.setOrigin(0,.5);for(let e=0;e<X.length;e++)for(let t=0;t<X.length;t++)A.grid.has(e,t)&&A.grid.get(e,t).setType(X[e][t]);null===(e=A.grid.get(0,3))||void 0===e||e.upgrade(),null===(t=A.grid.get(0,4))||void 0===t||t.upgrade(),null===(i=A.grid.get(0,5))||void 0===i||i.upgrade(),null===(s=A.grid.get(1,3))||void 0===s||s.upgrade(),null===(h=A.grid.get(1,4))||void 0===h||h.upgrade(),A.grid.get(1,5).counted=!0,A.grid.get(2,2).counted=!0,null===(r=A.grid.get(2,3))||void 0===r||r.upgrade(),null===(n=A.grid.get(2,4))||void 0===n||n.upgrade(),null===(o=A.grid.get(3,2))||void 0===o||o.upgrade(),null===(a=A.grid.get(4,0))||void 0===a||a.upgrade(),null===(d=A.grid.get(4,1))||void 0===d||d.upgrade(),null===(g=A.grid.get(4,2))||void 0===g||g.upgrade(),null===(u=A.grid.get(4,3))||void 0===u||u.upgrade(),null===(p=A.grid.get(4,4))||void 0===p||p.upgrade(),null===(x=A.grid.get(5,0))||void 0===x||x.upgrade(),null===(m=A.grid.get(5,1))||void 0===m||m.upgrade(),null===(v=A.grid.get(5,2))||void 0===v||v.upgrade(),A.grid.get(5,3).counted=!0,null===(T=A.grid.get(6,0))||void 0===T||T.upgrade(),null===(f=A.grid.get(6,1))||void 0===f||f.upgrade(),null===(y=A.grid.get(6,2))||void 0===y||y.upgrade(),null===(b=A.grid.get(6,3))||void 0===b||b.upgrade(),null===(k=A.grid.get(0,6))||void 0===k||k.setVisible(!1),null===(P=A.grid.get(3,0))||void 0===P||P.setVisible(!1),null===(E=A.grid.get(3,6))||void 0===E||E.setVisible(!1),A.updateEdges(),this.tutorialGrid=A,this.add.bitmapText(-1160,30,"font","0 points",60),new l(this,-1185,180,"rotate",()=>{console.log("a")}).setFlipX(!0),this.add.bitmapText(-1050,620,"font","25",60).setOrigin(.5,.45),this.add.image(-950,720,"a-shape").setAlpha(.5)}play(){this.cameras.main.pan(-1405,0,500,"Linear",!0),this.time.addEvent({delay:500,callback:this.transition,callbackScope:this});try{console.log("successfully initiated game score to 0")}catch(e){console.log("failed to init game score")}}transition(){this.scene.start("main",f)}howToPlay(){var e,t,i;this.tutorialPage=-1,this.nextTutorialPage(),this.cameras.main.pan(1270,0,1e3,"Power2"),null===(e=this.tutorialGrid.grid.get(0,6))||void 0===e||e.setVisible(!0),null===(t=this.tutorialGrid.grid.get(3,0))||void 0===t||t.setVisible(!0),null===(i=this.tutorialGrid.grid.get(3,6))||void 0===i||i.setVisible(!0)}nextTutorialPage(){if(this.tutorialPage+=1,this.tutorialPage>=w.length){var e,t,i;this.cameras.main.pan(640,0,1e3,"Power2"),null===(e=this.tutorialGrid.grid.get(0,6))||void 0===e||e.setVisible(!1),null===(t=this.tutorialGrid.grid.get(3,0))||void 0===t||t.setVisible(!1),null===(i=this.tutorialGrid.grid.get(3,6))||void 0===i||i.setVisible(!1)}else for(let e of(console.log(this.tutorialPage),this.tutorialText.setText(w[this.tutorialPage]),this.tutorialGrid.hexes))e.setSketchy(-1===T[this.tutorialPage].indexOf(e.hexType))}backTutorialPage(){if(console.log(this.tutorialPage),this.tutorialPage-=1,this.tutorialPage<0){var e,t,i;this.cameras.main.pan(640,0,1e3,"Power2"),null===(e=this.tutorialGrid.grid.get(0,6))||void 0===e||e.setVisible(!1),null===(t=this.tutorialGrid.grid.get(3,0))||void 0===t||t.setVisible(!1),null===(i=this.tutorialGrid.grid.get(3,6))||void 0===i||i.setVisible(!1)}else for(let e of(this.tutorialText.setText(w[this.tutorialPage]),this.tutorialGrid.hexes))e.setSketchy(-1===T[this.tutorialPage].indexOf(e.hexType))}update(e,t){for(let i of this.tutorialGrid.hexes)i.update(e,t)}constructor(){super("menu"),this.menu=null,this.background=null,this.tutorialGrid={},this.tutorialText=null,this.tutorialPage=0,this.tutorialButton=null,this.nextArrowBtn=null,this.previousArrowBtn=null}}class b extends s.Scene{init(e){this.currentLevel=e.level}create(){var e,t,i;this.levels=JSON.parse(this.cache.text.get("levels"));let h=this.game.registry.get("isSpeedVersion");this.add.rectangle(640,360,1280,720);let r=this.add.image(640,360,"map_pattern");if(r.setScale(.2),r.setAlpha(.1),this.score=0,this.levels[this.currentLevel-1].isMineTile?this.scoreBreakdown=[0,0,0,0,0,0,0,0]:this.scoreBreakdown=[0,0,0,0,0,0],this.pointerDown=!1,this.grid=new c(this,this.levels[this.currentLevel-1].hexSize,this.levels[this.currentLevel-1].hillsCount,0,0,this.onNewPoints.bind(this)),this.grid.placeRocks(2),this.trihexDeck=this.createTrihexDeck(this.levels[this.currentLevel-1].deckSize,!0),h?(this.scoreTextPositionX=-40,this.scoreBackgroundPositionX=-50):(this.scoreTextPositionX=140,this.scoreBackgroundPositionX=130),this.scoreText=this.add.bitmapText(this.scoreTextPositionX,30,"font","0 points",60),this.scoreText.setDepth(4),this.scoreBackground=this.add.graphics(),this.scoreBackground.fillStyle(3637769,.3),this.scoreBackground.fillRoundedRect(this.scoreBackgroundPositionX,25,225,80,8),this.scoreBackground.setDepth(3),this.tweens.add({targets:[this.scoreBackground,this.scoreText],props:{x:"+= 800"},duration:400}),h){this.timerPositionX=330,this.timerPositionY=65;let e=this.game.registry.get("speedDuration");this.timerBackground=this.add.graphics(),this.timerBackground.fillStyle(15658734,.3),this.timerBackground.fillRoundedRect(this.timerPositionX-140,this.timerPositionY-40,280,80,8),this.timerBackground.setDepth(3),this.tweens.add({targets:[this.timerBackground,this.timerText],props:{x:"+= 800"},duration:400}),h&&(this.initialTime=e,this.timerText=this.add.text(this.timerPositionX,this.timerPositionY,"Time Left: ".concat(this.formatTime(this.initialTime)),{fontSize:"30px",fontStyle:"bold",color:"#378209"}),this.timerText.setDepth(4),this.timerText.setOrigin(.5),this.timedEvent=this.time.addEvent({delay:1e3,callback:this.onEvent,callbackScope:this,loop:!0}))}this.rotateLeftButton=new l(this,125,180,"rotate",this.rotateLeft.bind(this)),this.rotateLeftButton.setDepth(3.5),this.rotateLeftButton.setFlipX(!0),this.rotateRightButton=new l(this,375,180,"rotate",this.rotateRight.bind(this)),this.rotateRightButton.setDepth(3.5),this.openHelpButton=new l(this,410,640,"question",this.openHelp.bind(this)),this.openHelpButton.setDepth(3.5),this.closeHelpButton=new l(this,1210,640,"x",this.closeHelp.bind(this)),this.closeHelpButton.setDepth(5.1),this.closeHelpButton.setVisible(!1),this.deckCounterText=this.add.bitmapText(240,620,"font",String(this.trihexDeck.length),60),this.deckCounterText.setOrigin(.5,.45),this.deckCounterText.setDepth(3.6),this.deckCounterImage=this.add.image(240,620,"a-shape"),this.deckCounterImage.setDepth(3.5),this.deckCounterImage.setAlpha(.5),this.bigPreviewContainer=this.add.container(1050,325),this.bigPreviewContainer.setDepth(4),this.bigPreviewTrihex=[];for(let e=0;e<3;e++){let e=new o(this,0,0,-1,-1);e.embiggen(),e.setDepth(4),this.bigPreviewTrihex.push(e),this.bigPreviewContainer.add(e),this.bigPreviewContainer.add(e.edges.getChildren()),this.bigPreviewContainer.add(e.propeller)}this.helpPage=this.add.image(640,360,"help-page"),this.helpPage.setScale(.4),this.helpPage.setDepth(5),this.helpPage.setVisible(!1),this.pickNextTrihex(),this.tweens.add({targets:this.rotateLeftButton,props:{x:this.rotateLeftButton.x+800},duration:400}),this.tweens.add({targets:this.openHelpButton,props:{x:this.openHelpButton.x+800},duration:400}),this.tweens.add({targets:this.rotateRightButton,props:{x:this.rotateRightButton.x+800},duration:400}),this.tweens.add({targets:this.scoreText,props:{x:this.scoreText.x+800},duration:400}),h&&this.tweens.add({targets:this.timerText,props:{x:(null!==(i=null===(t=this.timerText)||void 0===t?void 0:t.x)&&void 0!==i?i:0)+800},duration:400}),this.tweens.add({targets:[this.deckCounterText,this.deckCounterImage],props:{x:this.deckCounterText.x+800},duration:400}),this.input.on(s.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.input.on(s.Input.Events.POINTER_MOVE,this.onPointerMove,this),this.input.on(s.Input.Events.POINTER_UP,this.onPointerUp,this),null===(e=this.input.keyboard)||void 0===e||e.on(s.Input.Keyboard.Events.ANY_KEY_DOWN,this.onKeyDown,this),this.input.on("wheel",this.onMouseWheel,this)}onEvent(){var e,t,i,s,h;this.initialTime-=1,this.timerText&&(this.timerText.setText("Time Left: ".concat(this.formatTime(this.initialTime))),this.initialTime<=10&&(this.timerText.setColor("#E67E22"),null===(e=this.timerBackground)||void 0===e||e.fillStyle(15105570,.2),null===(t=this.timerBackground)||void 0===t||t.fillRoundedRect(this.timerPositionX-140+800,this.timerPositionY-40,280,60,10)),this.initialTime<=5&&(this.timerText.setColor("#DC143C"),null===(i=this.timerBackground)||void 0===i||i.fillStyle(14423100,.2),null===(s=this.timerBackground)||void 0===s||s.fillRoundedRect(this.timerPositionX-140+800,this.timerPositionY-40,280,60,10),this.pulseAndShakeTimer())),0===this.initialTime&&(null===(h=this.timedEvent)||void 0===h||h.remove(),this.grid.onQueueEmpty=this.endGame.bind(this),this.grid.deactivate(),this.timerText&&(this.timerText.setPosition(this.timerPositionX+800,this.timerPositionY),this.timerText.setScale(1)))}pulseAndShakeTimer(){this.tweens.add({targets:[this.timerText],scale:1.05,duration:200,yoyo:!0,repeat:1,ease:"Sine.easeInOut"}),this.tweens.add({targets:[this.timerText],x:this.timerPositionX+800+Phaser.Math.Between(-6,6),y:this.timerPositionY+Phaser.Math.Between(-6,6),duration:50,yoyo:!0,repeat:3,ease:"Sine.easeInOut"})}onNewPoints(e,t){var i;this.score+=e,this.scoreBreakdown[t]+=e,null===(i=this.scoreText)||void 0===i||i.setText(String(this.score)+" points")}async onPlaceTile(){}openHelp(){var e,t,i,s;null===(e=this.helpPage)||void 0===e||e.setVisible(!0),null===(t=this.closeHelpButton)||void 0===t||t.setVisible(!0),null===(i=this.openHelpButton)||void 0===i||i.setVisible(!1),null===(s=this.grid)||void 0===s||s.deactivate()}closeHelp(){var e,t,i,s;null===(e=this.helpPage)||void 0===e||e.setVisible(!1),null===(t=this.closeHelpButton)||void 0===t||t.setVisible(!1),null===(i=this.openHelpButton)||void 0===i||i.setVisible(!0),null===(s=this.grid)||void 0===s||s.activate()}onMouseWheel(e){e.deltaY>0&&this.rotateRight(),e.deltaY<0&&this.rotateLeft()}rotateRight(){var e,t;null===(e=this.nextTrihex)||void 0===e||e.rotateRight(),null===(t=this.grid)||void 0===t||t.updateTriPreview(this.previewX,this.previewY,this.nextTrihex),this.updateBigTrihex()}rotateLeft(){var e,t;null===(e=this.nextTrihex)||void 0===e||e.rotateLeft(),null===(t=this.grid)||void 0===t||t.updateTriPreview(this.previewX,this.previewY,this.nextTrihex),this.updateBigTrihex()}updateBigTrihex(){for(let h=0;h<3;h++){var e,t,i,s;let n=r[this.nextTrihex.shape][h].ro,o=r[this.nextTrihex.shape][h].co;(null===(e=this.nextTrihex)||void 0===e?void 0:e.shape)==="a"?this.bigPreviewTrihex[h].setX(90.932667*(o+.5*n)):(null===(t=this.nextTrihex)||void 0===t?void 0:t.shape)==="v"?this.bigPreviewTrihex[h].setX(90.932667*(o-.5+.5*n)):this.bigPreviewTrihex[h].setX(90.932667*(o+.5*n)),this.bigPreviewTrihex[h].setY(78.75*n),this.bigPreviewTrihex[h].setType(null===(i=this.nextTrihex)||void 0===i?void 0:i.hexes[h]),(null===(s=this.nextTrihex)||void 0===s?void 0:s.hexes[h])===0&&this.bigPreviewTrihex[h].setVisible(!1)}}createTrihexDeck(e,t){let i=[];for(let s=0;s<e;s++)t?s<e/3?i.push(new v(0,0,0,u(["a","v"]))):s<e/1.5?i.push(new v(0,0,0,u(["/","-","\\"]))):i.push(new v(0,0,0,u(["c","r","n","d","j","l"]))):i.push(new v(0,0,0,"a"));i=a(i);for(let t=0;t<e;t++)t<e/2?i[t].hexes[0]=3:i[t].hexes[0]=1;if(i=a(i),this.levels[this.currentLevel-1].isMineTile)for(let t=0;t<e;t++)t<2*e/10?i[t].hexes[1]=3:t<7*e/10?i[t].hexes[1]=6:i[t].hexes[1]=2;else for(let t=0;t<e;t++)t<e/2?i[t].hexes[1]=3:i[t].hexes[1]=2;i=a(i);for(let t=0;t<e;t++)t<e/2?i[t].hexes[2]=3:i[t].hexes[2]=2,i[t].hexes=a(i[t].hexes);return a(i)}pickNextTrihex(){var e,t,i,s,h,r,n,o,a;this.trihexDeck.length>0?(this.nextTrihex=this.trihexDeck.pop(),null===(e=this.deckCounterText)||void 0===e||e.setText(String(this.trihexDeck.length)),this.trihexDeck.length>0?null===(r=this.deckCounterImage)||void 0===r||r.setTexture({a:"a-shape",v:"a-shape","/":"slash-shape","-":"slash-shape","\\":"slash-shape",c:"c-shape",r:"c-shape",n:"c-shape",d:"c-shape",j:"c-shape",l:"c-shape"}[this.trihexDeck[this.trihexDeck.length-1].shape]):(null===(n=this.deckCounterImage)||void 0===n||n.setVisible(!1),null===(o=this.deckCounterText)||void 0===o||o.setText("")),this.updateBigTrihex(),null===(s=this.bigPreviewContainer)||void 0===s||s.setPosition(null===(t=this.deckCounterImage)||void 0===t?void 0:t.x,null===(i=this.deckCounterImage)||void 0===i?void 0:i.y),null===(h=this.bigPreviewContainer)||void 0===h||h.setScale(.2),this.tweens.add({targets:this.bigPreviewContainer,props:{x:1050,y:325,scale:1},duration:400})):(null===(a=this.bigPreviewContainer)||void 0===a||a.setVisible(!1),this.nextTrihex=new v(0,0,0,"a"))}waitForFinalScore(){this.grid.onQueueEmpty=this.endGame.bind(this)}endGame(){let e,t,i;let h=this.game.registry.get("isSpeedVersion");if(h){var r;null===(r=this.timedEvent)||void 0===r||r.remove()}this.grid.sinkBlanks();try{window.sessionStorage.removeItem("GAME_ENTRY_FEE_KEY")}catch(e){console.error("failed to unset game entry fees key")}this.tweens.add({targets:[this.bigPreviewContainer,this.rotateLeftButton,this.rotateRightButton,this.deckCounterImage,this.deckCounterText,this.openHelpButton],props:{alpha:0},duration:300}),this.tweens.add({targets:this.scoreText,props:{y:140},duration:700,ease:s.Math.Easing.Quadratic.Out}),h&&this.tweens.add({targets:this.timerText,props:{y:175},duration:700,ease:s.Math.Easing.Quadratic.Out}),this.tweens.add({targets:[this.scoreText],props:{y:140},duration:700,ease:s.Math.Easing.Quadratic.Out}),this.tweens.add({targets:[this.scoreBackground],props:{y:110},duration:700,ease:s.Math.Easing.Quadratic.Out}),this.tweens.add({targets:[this.timerText],props:{y:175},duration:700,ease:s.Math.Easing.Quadratic.Out}),this.tweens.add({targets:[this.timerBackground],props:{y:110},duration:700,ease:s.Math.Easing.Quadratic.Out}),0===this.score?(e="Rank: Z",t="What!?",i="(That's honestly impressive!)"):this.score<70?(e="Rank: E",t="Finished!",i="(Next rank at 70 points)"):this.score<80?(e="Rank: D",t="Not bad!",i="(Next rank at 80 points)"):this.score<90?(e="Rank: C",t="Good job!",i="(Next rank at 90 points)"):this.score<100?(e="Rank: B",t="Well done!",i="(Next rank at 100 points)"):this.score<110?(e="Rank: A",t="Excellent!",i="(Next rank at 110 points)"):this.score<120?(e="Rank: A+",t="Amazing!",i="(Next rank at 120 points)"):(this.score<125?(e="Rank: S",t="Incredible!!"):(e="Rank: S",t="A perfect score!!"),i="(This is the highest rank!)"),this.gameOverText=this.add.bitmapText(1625,70,"font",t,60),this.gameOverText.setOrigin(.5),this.gameOverText.setDepth(4),this.rankText=this.add.bitmapText(1625,460,"font",e,60),this.rankText.setOrigin(.5),this.rankText.setDepth(4),this.nextRankText=this.add.bitmapText(1625,520,"font",i,40),this.nextRankText.setOrigin(.5),this.nextRankText.setDepth(4);let n=this.getGameStartTime();this.currentTimeText=this.add.bitmapText(1625,590,"font","Played At: ".concat(n),24),this.currentTimeText.setOrigin(.5),this.currentTimeText.setDepth(4),this.playAgainButton=this.add.bitmapText(1525,630,"font","Play Again",40).setInteractive({useHandCursor:!0}).setOrigin(.5).on("pointerover",()=>{this.tweens.add({targets:this.playAgainButton,scaleX:1.1,scaleY:1.1,duration:60,ease:"Linear"})}).on("pointerover",()=>{this.tweens.add({targets:this.playAgainButton,scaleX:1.1,scaleY:1.1,duration:60,ease:"Linear"})}).on("pointerout",()=>this.tweens.add({targets:this.playAgainButton,scaleX:1,scaleY:1,duration:60,ease:"Linear"})).on("pointerdown",()=>{this.tweens.add({targets:this.playAgainButton,scaleX:1.1,scaleY:1.1,duration:60,ease:"Linear"}),this.playAgain()}).on("pointerup",()=>{this.playAgain()}).setDepth(4),this.nextLevelButton=this.add.bitmapText(1525,410,"font","Next Round",40).setInteractive({useHandCursor:!0}).setOrigin(.5).on("pointerover",()=>{this.tweens.add({targets:this.nextLevelButton,scaleX:1.1,scaleY:1.1,duration:60,ease:"Linear"})}).on("pointerover",()=>{this.tweens.add({targets:this.nextLevelButton,scaleX:1.1,scaleY:1.1,duration:60,ease:"Linear"})}).on("pointerout",()=>this.tweens.add({targets:this.nextLevelButton,scaleX:1,scaleY:1,duration:60,ease:"Linear"})).on("pointerdown",()=>{this.tweens.add({targets:this.nextLevelButton,scaleX:1.1,scaleY:1.1,duration:60,ease:"Linear"}),this.nextRound()}).setDepth(4),this.breakdownContainer=this.add.container(1625,300),this.breakdownContainer.setDepth(4),this.breakdownHexes=[],this.breakdownTexts=[];let a=3;a=this.levels[this.currentLevel-1].isMineTile?4:3;for(let e=0;e<a;e++){let e=new o(this,0,0,-1,-1);e.embiggen(),e.setDepth(4),this.breakdownContainer.add(e),this.breakdownHexes.push(e),this.breakdownContainer.add(e.edges.getChildren()),this.breakdownContainer.add(e.propeller);let t=this.add.bitmapText(0,80,"font","0",40);t.setOrigin(.5),this.breakdownTexts.push(t),this.breakdownContainer.add(t)}this.breakdownHexes[0].setType(3),this.breakdownHexes[0].upgrade(),this.breakdownHexes[0].setX(-125),this.breakdownTexts[0].setX(-125),this.breakdownTexts[0].setText(String(this.scoreBreakdown[3]+this.scoreBreakdown[5])),this.breakdownHexes[1].setType(2),this.breakdownHexes[1].upgrade(),this.breakdownTexts[1].setText(String(this.scoreBreakdown[2])),this.breakdownHexes[2].setType(1),this.breakdownHexes[2].setX(125),this.breakdownTexts[2].setX(125),this.breakdownTexts[2].setText(String(this.scoreBreakdown[1])),this.levels[this.currentLevel-1].isMineTile&&(this.breakdownHexes[3].setType(6),this.breakdownHexes[3].setX(250),this.breakdownTexts[3].setX(250),this.breakdownTexts[3].setText(String(this.scoreBreakdown[6]))),this.tweens.add({targets:this.gameOverText,props:{x:1105},delay:300,duration:300,ease:s.Math.Easing.Quadratic.Out}),this.tweens.add({targets:this.breakdownContainer,props:{x:1105},delay:600,duration:300,ease:s.Math.Easing.Quadratic.Out}),this.tweens.add({targets:[this.rankText,this.nextRankText,this.nextLevelButton],props:{x:1105},delay:900,duration:300,ease:s.Math.Easing.Quadratic.Out}),this.tweens.add({targets:this.playAgainButton,props:{x:1105},delay:1200,duration:300,ease:s.Math.Easing.Quadratic.Out})}playAgain(){var e,t,i,s,h,r,n,o,a,l,d,g;null===(e=this.breakdownContainer)||void 0===e||e.setVisible(!1),null===(t=this.gameOverText)||void 0===t||t.setVisible(!1),null===(i=this.nextRankText)||void 0===i||i.setVisible(!1),null===(s=this.rankText)||void 0===s||s.setVisible(!1),null===(h=this.playAgainButton)||void 0===h||h.setVisible(!1),null===(r=this.scoreText)||void 0===r||r.setVisible(!1),null===(n=this.timerText)||void 0===n||n.setVisible(!1),null===(o=this.scoreBackground)||void 0===o||o.setVisible(!1),null===(a=this.scoreBackground)||void 0===a||a.setVisible(!1),null===(l=this.timerBackground)||void 0===l||l.setVisible(!1),null===(d=this.currentTimeText)||void 0===d||d.setVisible(!1),null===(g=this.nextLevelButton)||void 0===g||g.setVisible(!1),this.time.addEvent({callback:this.scene.restart,callbackScope:this.scene,delay:500})}nextRound(){var e,t,i,s,h,r,n,o,a,l,d,g;null===(e=this.breakdownContainer)||void 0===e||e.setVisible(!1),null===(t=this.gameOverText)||void 0===t||t.setVisible(!1),null===(i=this.nextRankText)||void 0===i||i.setVisible(!1),null===(s=this.rankText)||void 0===s||s.setVisible(!1),null===(h=this.playAgainButton)||void 0===h||h.setVisible(!1),null===(r=this.scoreText)||void 0===r||r.setVisible(!1),null===(n=this.timerText)||void 0===n||n.setVisible(!1),null===(o=this.scoreBackground)||void 0===o||o.setVisible(!1),null===(a=this.scoreBackground)||void 0===a||a.setVisible(!1),null===(l=this.timerBackground)||void 0===l||l.setVisible(!1),null===(d=this.currentTimeText)||void 0===d||d.setVisible(!1),null===(g=this.nextLevelButton)||void 0===g||g.setVisible(!1),this.time.addEvent({callback:()=>{this.currentLevel<5?this.currentLevel=(this.currentLevel||0)+1:this.currentLevel=5;let e={level:this.currentLevel};this.scene.restart(e)},delay:500})}navigateToExternalSite(e){window.open(e,"_blank")}formatTime(e){let t=e%60;return t=t.toString().padStart(2,"0"),"".concat(Math.floor(e/60),":").concat(t)}onPointerUp(e){this.pointerDown&&(this.previewX=e.worldX,this.previewY=e.worldY,this.placeTrihex()),this.pointerDown=!1}placeTrihex(){var e,t,i;(null===(e=this.grid)||void 0===e?void 0:e.enabled)&&this.grid.placeTrihex(this.previewX,this.previewY,this.nextTrihex,this.onPlaceTile.bind(this))&&(this.pickNextTrihex(),(null===(t=this.nextTrihex)||void 0===t?void 0:t.hexes[0])!==0&&this.grid.canPlaceShape(null===(i=this.nextTrihex)||void 0===i?void 0:i.shape)||(this.time.addEvent({callback:this.waitForFinalScore,callbackScope:this,delay:1e3}),this.grid.deactivate()),this.grid.updateTriPreview(-100,-100,this.nextTrihex))}onPointerDown(e){if(e.worldX===this.previewX&&e.worldY===this.previewY)this.placeTrihex();else{var t;this.previewX=e.worldX,this.previewY=e.worldY,null===(t=this.grid)||void 0===t||t.updateTriPreview(e.worldX,e.worldY,this.nextTrihex)}this.pointerDown=!0}onPointerMove(e){var t;this.previewX=e.worldX,this.previewY=e.worldY,null===(t=this.grid)||void 0===t||t.updateTriPreview(e.worldX,e.worldY,this.nextTrihex)}onKeyDown(e){(39===e.keyCode||68===e.keyCode)&&this.rotateRight(),(37===e.keyCode||65===e.keyCode)&&this.rotateLeft()}getGameStartTime(){let e=new Date,t=["January","February","March","April","May","June","July","August","September","October","November","December"][e.getUTCMonth()],i=e.getUTCDate(),s=e.getUTCFullYear(),h=e.getUTCHours().toString().padStart(2,"0"),r=e.getUTCMinutes().toString().padStart(2,"0"),n=e.getUTCSeconds().toString().padStart(2,"0");return"".concat(t," ").concat(i,", ").concat(s," ").concat(h,":").concat(r,":").concat(n," UTC")}update(e,t){var i,s;for(let i of(super.update(e,t),this.grid.hexes))i.update(e,t);null===(i=this.waves)||void 0===i||i.setX(640+10*Math.sin(.001*e)),null===(s=this.waves2)||void 0===s||s.setX(640-10*Math.sin(.001*e))}constructor(){super("main"),this.grid=null,this.foreground=null,this.nextType=0,this.nextTrihex=null,this.nextNextTrihex=null,this.trihexDeck=[],this.bigPreviewTrihex=[],this.bigPreviewContainer=null,this.deckCounterImage=null,this.deckCounterText=null,this.rotateLeftButton=null,this.rotateRightButton=null,this.openHelpButton=null,this.closeHelpButton=null,this.helpPage=null,this.score=0,this.initialTime=0,this.scoreBreakdown=[],this.scoreText=null,this.scoreTextPositionX=0,this.timerText=null,this.timedEvent=null,this.timerPositionX=0,this.timerPositionY=0,this.scoreBackground=null,this.scoreBackgroundPositionX=0,this.timerBackground=null,this.waves=null,this.waves2=null,this.pointerDown=!1,this.previewX=0,this.previewY=0,this.gameOverText=null,this.rankText=null,this.nextRankText=null,this.currentTimeText=null,this.playAgainButton=null,this.nextLevelButton=null,this.breakdownContainer=null,this.breakdownHexes=[],this.breakdownTexts=[],this.currentLevel=0,this.levels=[]}}},5566:function(e){var t,i,s,h=e.exports={};function r(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(i){try{return t.call(null,e,0)}catch(i){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{i="function"==typeof clearTimeout?clearTimeout:n}catch(e){i=n}}();var a=[],l=!1,d=-1;function g(){l&&s&&(l=!1,s.length?a=s.concat(a):d=-1,a.length&&u())}function u(){if(!l){var e=o(g);l=!0;for(var t=a.length;t;){for(s=a,a=[];++d<t;)s&&s[d].run();d=-1,t=a.length}s=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===n||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function c(){}h.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];a.push(new p(e,t)),1!==a.length||l||o(u)},p.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.prependListener=c,h.prependOnceListener=c,h.listeners=function(e){return[]},h.binding=function(e){throw Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw Error("process.chdir is not supported")},h.umask=function(){return 0}}}]);